{
  "hash": "e99adbbe2c64a89fbc19fe093202b9c0",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Type-safe LLM agents with PydanticAI\"\nauthor: \"Paul Simmering\"\ndate: \"2024-12-15\"\ncategories: [\"Machine Learning\", \"Python\"]\nimage: \"image.jpg\"\ncode-annotations: select\n---\n\n\nPydantic AI is a new agent framework by the company behind Pydantic, the popular data validation library. Pydantic has transformed how I write Python, so I'm excited for their take on agents. In this article I'll walk through an example app and comment on my experience developing with PydanticAI.\n\n::: {.callout-note collapse=\"true\"}\n## PydanticAI version 0.0.12\n\nPydanticAI is currently in beta. The assessment of the library in this article is based on version 0.0.12. Code examples may not work with future versions.\n:::\n\n\n- currently supports OpenAI, Anthropic, Gemini, Ollama, Groq, Mistral and also has an interface to add more providers\n- type safe with structured responses including streamed responses\n- optional integration with [Logfire](https://pydantic.dev/logfire), a commercial service by the Pydantic team for logging LLM calls\n\nType-safety is a big deal in agent development - the more tools an agent has at its disposal and the more complex their arguments are, the higher the risk of type errors.\n\n## Example app: Market research knowledge manager\n\nLarge companies conduct market research to understand their customers, competition and market trends. Over time, they amass a library of thousands of reports, tables and transcripts. Knowledge management becomes a challenge, because teams are not aware of existing research.\n\nLet's build an example agent that answers questions based on information in a database with multiple tables.\n\n\n\n\n\n### Database\n\nI'm using [DuckDB](https://duckdb.org) to create a local database which will be made available to the agent.\n\n::: {#bc29b192 .cell execution_count=3}\n``` {.python .cell-code}\nimport duckdb\n\ncon = duckdb.connect()  # <1>\ncon.execute(\"INSTALL vss\")  # <2>\ncon.execute(\"LOAD vss\")\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```\n<duckdb.duckdb.DuckDBPyConnection at 0x16838f870>\n```\n:::\n:::\n\n\n1. Create an ephemeral in-memory database. In production you'd want to use a persistent database.\n2. Install the vector similarity search extension, which will be needed for fuzzy title matching.\n\nI'll insert a set of reports into the database. The data included is fictional and was generated by an LLM. The data consists of 40 reports like this:\n\n::: {#4408ee14 .cell execution_count=4}\n``` {.python .cell-code}\nimport polars as pl\nfrom great_tables import GT\n\nreports = pl.read_csv(\"data/reports.csv\")\nGT(reports.head(5))\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<div id=\"ggtxmjgqhw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#ggtxmjgqhw table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#ggtxmjgqhw thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#ggtxmjgqhw p { margin: 0; padding: 0; }\n #ggtxmjgqhw .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #ggtxmjgqhw .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #ggtxmjgqhw .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #ggtxmjgqhw .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #ggtxmjgqhw .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #ggtxmjgqhw .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #ggtxmjgqhw .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #ggtxmjgqhw .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #ggtxmjgqhw .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #ggtxmjgqhw .gt_column_spanner_outer:first-child { padding-left: 0; }\n #ggtxmjgqhw .gt_column_spanner_outer:last-child { padding-right: 0; }\n #ggtxmjgqhw .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }\n #ggtxmjgqhw .gt_spanner_row { border-bottom-style: hidden; }\n #ggtxmjgqhw .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }\n #ggtxmjgqhw .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }\n #ggtxmjgqhw .gt_from_md> :first-child { margin-top: 0; }\n #ggtxmjgqhw .gt_from_md> :last-child { margin-bottom: 0; }\n #ggtxmjgqhw .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }\n #ggtxmjgqhw .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #ggtxmjgqhw .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #ggtxmjgqhw .gt_row_group_first td { border-top-width: 2px; }\n #ggtxmjgqhw .gt_row_group_first th { border-top-width: 2px; }\n #ggtxmjgqhw .gt_striped { background-color: rgba(128,128,128,0.05); }\n #ggtxmjgqhw .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #ggtxmjgqhw .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #ggtxmjgqhw .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #ggtxmjgqhw .gt_left { text-align: left; }\n #ggtxmjgqhw .gt_center { text-align: center; }\n #ggtxmjgqhw .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #ggtxmjgqhw .gt_font_normal { font-weight: normal; }\n #ggtxmjgqhw .gt_font_bold { font-weight: bold; }\n #ggtxmjgqhw .gt_font_italic { font-style: italic; }\n #ggtxmjgqhw .gt_super { font-size: 65%; }\n #ggtxmjgqhw .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #ggtxmjgqhw .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"id\">id</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"institute\">institute</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"country\">country</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"topic\">topic</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"title\">title</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr>\n    <td class=\"gt_row gt_right\">1</td>\n    <td class=\"gt_row gt_left\">2018-07-20</td>\n    <td class=\"gt_row gt_left\">Research DNA GmbH</td>\n    <td class=\"gt_row gt_left\">Germany</td>\n    <td class=\"gt_row gt_left\">Automotive</td>\n    <td class=\"gt_row gt_left\">Global Electric Vehicle Market Outlook 2018-2023</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">2</td>\n    <td class=\"gt_row gt_left\">2018-08-15</td>\n    <td class=\"gt_row gt_left\">Market Insights Inc.</td>\n    <td class=\"gt_row gt_left\">USA</td>\n    <td class=\"gt_row gt_left\">Healthcare</td>\n    <td class=\"gt_row gt_left\">Digital Health Market Size and Growth Analysis</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">3</td>\n    <td class=\"gt_row gt_left\">2018-09-10</td>\n    <td class=\"gt_row gt_left\">Global Trends Research</td>\n    <td class=\"gt_row gt_left\">UK</td>\n    <td class=\"gt_row gt_left\">FMCG</td>\n    <td class=\"gt_row gt_left\">Premium Beauty and Personal Care Market Trends</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">4</td>\n    <td class=\"gt_row gt_left\">2018-10-05</td>\n    <td class=\"gt_row gt_left\">Data Analytics Group</td>\n    <td class=\"gt_row gt_left\">Canada</td>\n    <td class=\"gt_row gt_left\">Electronics</td>\n    <td class=\"gt_row gt_left\">Smartphone Industry Competitive Analysis</td>\n  </tr>\n  <tr>\n    <td class=\"gt_row gt_right\">5</td>\n    <td class=\"gt_row gt_left\">2018-11-12</td>\n    <td class=\"gt_row gt_left\">Innovative Solutions Ltd.</td>\n    <td class=\"gt_row gt_left\">Australia</td>\n    <td class=\"gt_row gt_left\">Insurance</td>\n    <td class=\"gt_row gt_left\">Insurtech Market Landscape and Opportunities</td>\n  </tr>\n</tbody>\n\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nTo make the title searchable, I'll embed it using an [OpenAI embedding endpoint](https://platform.openai.com/docs/guides/embeddings). The result will be stored in a new column with 1536 dimensions.\n\n::: {#9eb89b1f .cell execution_count=5}\n``` {.python .cell-code}\nfrom openai import OpenAI\nfrom tqdm import tqdm\nimport pickle\n\n\ndef embed_text(text: str) -> list[float]:\n    client = OpenAI()\n    model = \"text-embedding-3-small\"\n    return client.embeddings.create(input=text, model=model).data[0].embedding\n\n\n# Load cache\ntry:\n    with open(\"title_embeddings_cache.pkl\", \"rb\") as f:\n        cache = pickle.load(f)\nexcept FileNotFoundError:\n    cache = {}\n\n# Embed titles with caching\ntitle_embeddings = []\nfor title in tqdm(reports[\"title\"]):\n    if title not in cache:\n        cache[title] = embed_text(title)\n    title_embeddings.append(cache[title])\n\n# Save cache\nwith open(\"title_embeddings_cache.pkl\", \"wb\") as f:\n    pickle.dump(cache, f)\n\nreports = reports.with_columns(\n    pl.Series(\n        name=\"title_embedding\",\n        values=title_embeddings,\n        dtype=pl.Array(inner=pl.Float64, shape=1536),\n    )\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/40 [00:00<?, ?it/s]\r100%|██████████| 40/40 [00:00<00:00, 476625.45it/s]\n```\n:::\n:::\n\n\nNow, I'll insert the data including the embeddings into the database. The embeddings are stored in a fixed-size `ARRAY` column. The co-location of the structured data and the embeddings in the same table is convenient for our use case.\n\n::: {#cb224c72 .cell execution_count=6}\n``` {.python .cell-code}\ncon.execute(\n    \"\"\"\n    CREATE OR REPLACE TABLE reports AS\n    SELECT\n        id::varchar AS id,\n        date::date AS date,\n        institute::varchar AS institute,\n        country::varchar AS country,\n        topic::varchar AS topic,\n        title::varchar AS title,\n        title_embedding::float[1536] AS title_embedding\n    FROM reports;\n    \"\"\"  # <1>\n)\n\ncon.execute(\n    \"CREATE INDEX titles_hnsw_index ON reports USING HNSW(title_embedding) WITH (metric='cosine');\"\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=32}\n```\n<duckdb.duckdb.DuckDBPyConnection at 0x16838f870>\n```\n:::\n:::\n\n\n1. This works because DuckDB can read from a Polars DataFrame.\n\nI also create a hierarchical navigable small world (HNSW) index on the title embeddings. This enables approximate nearest neighbor search with logarithmic complexity. It's enabled by the [vss](https://duckdb.org/docs/extensions/vss) extension.\n\n### Agent\n\nLet's set up an agent powered by the [Groq](https://groq.com) inference API. It serves a range of open source models. Specifically, I'll use the `llama-3.3-70b-versatile` model released by Meta on December 6th. Artificial Analysis has a detailed [report](https://artificialanalysis.ai/models/llama-3-3-instruct-70b/providers) showing that it advanced the speed-accuracy trade-off. The model has tool calling capabilities, which are critical for our use case.\n\n::: {#4f7c8cf7 .cell execution_count=7}\n``` {.python .cell-code}\nfrom pydantic_ai import Agent\n\nagent = Agent(\n    model=\"groq:llama-3.3-70b-versatile\",  # <1>\n    system_prompt=\"You are a market research expert and answer questions using a database of reports.\",\n)\n\nresult = agent.run_sync(\"Who are you?\")\nprint(result.data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nI am a market research expert, providing insights and answers based on a vast database of reports and studies. My expertise spans various industries, markets, and trends, allowing me to offer data-driven responses to your questions. Whether you're looking for information on consumer behavior, market size, competitive analysis, or emerging trends, I'm here to help. What would you like to know?\n```\n:::\n:::\n\n\n1. See the [KnownModelName](https://ai.pydantic.dev/api/models/base/#pydantic_ai.models.KnownModelName) documentation for a list of supported models.\n\nLet's add tools to the agent. First, it needs a way to access the database.\n\n::: {#85e7b4b2 .cell execution_count=8}\n``` {.python .cell-code}\nfrom dataclasses import dataclass\n\n\n@dataclass\nclass SupportDependencies:  # <1>\n    db: duckdb.DuckDBPyConnection\n\n\ndeps = SupportDependencies(db=con)\n```\n:::\n\n\n1. A dataclass that contains dependencies needed by the agent.\n\nNext, let's give the agent a tool to search the database of reports. Based on the user's question, it can choose which field to search. The result is always a markdown-formatted table with one row per report.\n\n::: {#3400e2ba .cell execution_count=9}\n``` {.python .cell-code}\nfrom typing import Literal\nfrom pydantic_ai import RunContext\nfrom pydantic import validate_call, Field\n\n\n@agent.tool  # <1>\n@validate_call(config={\"arbitrary_types_allowed\": True})  # <2>\ndef search_reports_by_field(\n    ctx: RunContext[SupportDependencies],  # <3>\n    field: Literal[\"id\", \"date\", \"institute\", \"country\", \"topic\", \"title\"],  # <4>\n    value: str = Field(\n        description=\"The value to search for in the field. Case insensitive.\"\n    ),\n) -> str:\n    query = f\"SELECT date, institute, country, topic, title FROM reports WHERE lower({field}) = lower(?)\"\n    df = ctx.deps.db.execute(query, [value]).df()  # <5>\n    if df.shape[0] == 0:\n        return \"No reports found.\"  # <6>\n    return df.to_markdown()\n```\n:::\n\n\n1. Use the `@agent.tool` decorator to register the function as a tool.\n2. Use the `@validate_call` decorator to enable type checking of the function arguments. `arbitrary_types_allowed` is required because the `RunContext` type is not a standard type.\n3. The `RunContext` type hint is required for the tool to access the dependencies.\n4. Tell the model about the available fields in the database and validate that only those are selected.\n5. The database query returns a pandas DataFrame, which is converted to a markdown-formatted string.\n6. Provide a clear message if no reports are found. Otherwise, the function would return a markdown table with no rows, which could be confusing.\n\n::: {#003a7678 .cell execution_count=10}\n``` {.python .cell-code}\ndeps = SupportDependencies(db=con)\nresult = agent.run_sync(\"Which reports do we have from Germany?\", deps=deps)\nprint(result.data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWe have four reports from Germany:\n1. \"Global Electric Vehicle Market Outlook 2018-2023\" by Research DNA GmbH, published on July 20, 2018, focusing on the automotive topic.\n2. \"Digital Advertising Spend Analysis\" by Tech Innovations Ltd., published on March 10, 2020, focusing on the media topic.\n3. \"Beverage Market Competitive Analysis\" by Research DNA GmbH, published on January 5, 2022, focusing on the FMCG topic.\n4. \"Medical Imaging Equipment Market Size\" by Tech Innovations Ltd., published on February 1, 2024, focusing on the healthcare topic.\n```\n:::\n:::\n\n\nThis lets the agent execute searches based on the exact match of a field. However, users are unlikely to remember the exact title or id of a report, so let's also add the ability to search for similar titles.\n\n::: {#2824f1a4 .cell execution_count=11}\n``` {.python .cell-code}\n@agent.tool\n@validate_call(config={\"arbitrary_types_allowed\": True})\ndef search_reports_by_title_similarity(\n    ctx: RunContext[SupportDependencies],\n    title: str,\n) -> str:\n    # Embed the title given by the user\n    try:\n        title_embedding = embed_text(title)\n    except Exception as e:\n        return f\"Error embedding title: {e}\"\n\n    # Search for similar titles\n    title_embedding_str = \"[\" + \",\".join(map(str, title_embedding)) + \"]\"\n    query = \"\"\"\n        SELECT date, institute, country, topic, title\n        FROM reports\n        ORDER BY array_distance(title_embedding, ?::FLOAT[1536])\n        LIMIT 5\n    \"\"\"\n    df = ctx.deps.db.execute(query, [title_embedding_str]).df()\n    if df.shape[0] == 0:\n        return \"No reports found.\"\n    return df.to_markdown()\n```\n:::\n\n\nLet's ask the agent about a topic that is not in the database.\n\n::: {#92f045e5 .cell execution_count=12}\n``` {.python .cell-code}\nresult = agent.run_sync(\"Search for reports mentioning quantum computing\", deps=deps)\nprint(result.data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nUnfortunately, there are no reports in the database that mention quantum computing. The search results show reports from various institutes and countries, but none of them are related to quantum computing. If you're looking for information on this topic, I suggest trying a different search term or checking other databases.\n```\n:::\n:::\n\n\nTo see which tool the agent chose, we can inspect the message history.\n\n::: {#12a15efe .cell execution_count=13}\n``` {.python .cell-code}\nfor message in result.all_messages():\n    print(message)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSystemPrompt(content='You are a market research expert and answer questions using a database of reports.', role='system')\nUserPrompt(content='Search for reports mentioning quantum computing', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 33, 37839, tzinfo=datetime.timezone.utc), role='user')\nModelStructuredResponse(calls=[ToolCall(tool_name='search_reports_by_title_similarity', args=ArgsJson(args_json='{\"title\": \"quantum computing\"}'), tool_id='call_dmmx')], timestamp=datetime.datetime(2024, 12, 15, 10, 55, 33, tzinfo=datetime.timezone.utc), role='model-structured-response')\nToolReturn(tool_name='search_reports_by_title_similarity', content='|    | date                | institute            | country   | topic       | title                                |\\n|---:|:--------------------|:---------------------|:----------|:------------|:-------------------------------------|\\n|  0 | 2024-04-06 00:00:00 | Education Analytics  | Canada    | Electronics | Semiconductor Industry Analysis      |\\n|  1 | 2022-03-10 00:00:00 | Market Insights Inc. | USA       | Electronics | Gaming Hardware Market Assessment    |\\n|  2 | 2020-07-30 00:00:00 | Education Analytics  | Canada    | Healthcare  | Healthcare IT Market Growth Analysis |\\n|  3 | 2023-07-25 00:00:00 | Market Dynamics      | Italy     | Insurance   | Cyber Insurance Market Assessment    |\\n|  4 | 2021-07-18 00:00:00 | Telecom Research Hub | Spain     | Automotive  | Connected Car Market Opportunities   |', tool_id='call_dmmx', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 34, 255689, tzinfo=datetime.timezone.utc), role='tool-return')\nModelStructuredResponse(calls=[ToolCall(tool_name='search_reports_by_field', args=ArgsJson(args_json='{\"field\": \"topic\", \"value\": \"Electronics\"}'), tool_id='call_s389'), ToolCall(tool_name='search_reports_by_field', args=ArgsJson(args_json='{\"field\": \"topic\", \"value\": \"Technology\"}'), tool_id='call_n0ze'), ToolCall(tool_name='search_reports_by_title_similarity', args=ArgsJson(args_json='{\"title\": \"Quantum Computing\"}'), tool_id='call_qhpp'), ToolCall(tool_name='search_reports_by_field', args=ArgsJson(args_json='{\"field\": \"institute\", \"value\": \"Market Insights Inc.\"}'), tool_id='call_jx99')], timestamp=datetime.datetime(2024, 12, 15, 10, 55, 34, tzinfo=datetime.timezone.utc), role='model-structured-response')\nToolReturn(tool_name='search_reports_by_field', content='No reports found.', tool_id='call_s389', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 34, 869134, tzinfo=datetime.timezone.utc), role='tool-return')\nToolReturn(tool_name='search_reports_by_field', content='No reports found.', tool_id='call_n0ze', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 34, 869189, tzinfo=datetime.timezone.utc), role='tool-return')\nToolReturn(tool_name='search_reports_by_title_similarity', content='|    | date                | institute            | country   | topic       | title                                |\\n|---:|:--------------------|:---------------------|:----------|:------------|:-------------------------------------|\\n|  0 | 2024-04-06 00:00:00 | Education Analytics  | Canada    | Electronics | Semiconductor Industry Analysis      |\\n|  1 | 2022-03-10 00:00:00 | Market Insights Inc. | USA       | Electronics | Gaming Hardware Market Assessment    |\\n|  2 | 2023-07-25 00:00:00 | Market Dynamics      | Italy     | Insurance   | Cyber Insurance Market Assessment    |\\n|  3 | 2020-07-30 00:00:00 | Education Analytics  | Canada    | Healthcare  | Healthcare IT Market Growth Analysis |\\n|  4 | 2021-07-18 00:00:00 | Telecom Research Hub | Spain     | Automotive  | Connected Car Market Opportunities   |', tool_id='call_qhpp', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 35, 282999, tzinfo=datetime.timezone.utc), role='tool-return')\nToolReturn(tool_name='search_reports_by_field', content='|    | date                | institute            | country   | topic       | title                                          |\\n|---:|:--------------------|:---------------------|:----------|:------------|:-----------------------------------------------|\\n|  0 | 2018-08-15 00:00:00 | Market Insights Inc. | USA       | Healthcare  | Digital Health Market Size and Growth Analysis |\\n|  1 | 2022-03-10 00:00:00 | Market Insights Inc. | USA       | Electronics | Gaming Hardware Market Assessment              |', tool_id='call_jx99', timestamp=datetime.datetime(2024, 12, 15, 10, 55, 34, 870446, tzinfo=datetime.timezone.utc), role='tool-return')\nModelTextResponse(content=\"Unfortunately, there are no reports in the database that mention quantum computing. The search results show reports from various institutes and countries, but none of them are related to quantum computing. If you're looking for information on this topic, I suggest trying a different search term or checking other databases.\", timestamp=datetime.datetime(2024, 12, 15, 10, 55, 35, tzinfo=datetime.timezone.utc), role='model-text-response')\n```\n:::\n:::\n\n\nThe model ended up making three tool calls:\n\n1. `search_reports_by_title_similarity` to find titles similar to \"quantum computing\". It got a result but was smart enough to understand that they were not relevant.\n2. `search_reports_by_field` to find reports with the topic \"Electronics\". It got results and again understood that they were not relevant.\n3. `search_reports_by_field` to find reports with the topic \"Quantum Computing\" with no results.\n\nTODO: Talk about what other tools could be added.\nTODO: Read other examples from PydanticAI documentation.\n\n## Discussion\n\n### Comparison to other libraries\n\nPydanticAI is a late entrant to the agent framework space. It joins several established libraries including:\n\n| Library | Description | Github Stars ⭐ |\n|---------|-------------|-------------:|\n| [AutoGPT](https://github.com/Significant-Gravitas/AutoGPT) | AI automation platform with frontend, server and monitoring | 169k |\n| [LangChain](https://github.com/langchain-ai/langchain) | Package ecosystem for LLM applications | 96k |\n| [autogen](https://github.com/microsoft/autogen) | Multi-agent AI chat framework by Microsoft | 36k |\n| [crewAI](https://github.com/crewAIInc/crewai) | Framework for orchestrating role-based AI agents | 22k |\n| [swarm](https://github.com/openai/swarm) | Educational framework for multi-agent apps by OpenAI | 17k |\n| [phidata](https://github.com/phidatahq/phidata) | Multi-agent backend and chat frontent | 16k |\n\nThere are dozens of other libraries with fewer stars. In addition, there are libraries specialized for RAG like [LlamaIndex](https://github.com/run-llama/llama_index) and [Haystack](https://github.com/deepset-ai/haystack). The competition landscape doesn't show signs of consolidation or slowing down.\n\n### Development team\n\nPydantic Services, the company behind Pydantic, has raised a $12.5m [Series A](https://www.crunchbase.com/funding_round/pydantic-services-series-a--ddd115fb) in October 2024. This is great news for the project: funding pays for full time developers. Of course, it raises the question of how Pydantic will make money, and the answer to that is Logfire. This is a good model that gives long-term stability to the project and follows the lead of LangChain with its commercial product, [LangSmith](https://www.langchain.com/langsmith).\n\nI just hope that the integration remains optional. While Logfire looks great, my team already uses [Weave](https://wandb.ai/site/weave/) by Weights & Biases, and having to switch would be a barrier to adopting PydanticAI.\n\n### Review\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n**Pros ✅**\n\n- Sensible abstractions that don't get in the way.\n- Type safety and integration with Pydantic.\n- Strong reputation of the Pydantic team.\n- Pydantic is familiar to many Python developers who will have an easier time learning PydanticAI.\n- Great support for streaming responses and async tool calling. This is critical for live chat applications.\n- High quality documentation and examples.\n:::\n\n::: {.column width=\"50%\"}\n**Cons ❌**\n\n- Launches into a competitive market with many established libraries.\n- Early stage of development, so expect breaking changes.\n- Economic incentives to lock users into Logfire. This hasn't happened but is a risk.\n:::\n\n::::\n\nI'm looking forward to an opportunity to build a full-scale application with PydanticAI.\n\nPhoto by <a href=\"https://unsplash.com/@magicpattern?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\">MagicPattern</a> on <a href=\"https://unsplash.com/photos/purple-and-black-polka-dot-textile-eHH_5rn3xnU?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\">Unsplash</a>\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}